<div class="detail-container">
  <!-- Back Button -->
  <button class="btn-back" (click)="goBack()">
    <i class="bi bi-arrow-left me-2"></i>
    Back to Applications
  </button>

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading application details...</p>
    </div>
  } @else if (application()) {
    <!-- Header -->
    <div class="detail-header">
      <div class="header-left">
        <div class="company-avatar">
          @if (application()!.job?.companyLogo) {
            <img [src]="application()!.job!.companyLogo" [alt]="application()!.job?.company" />
          } @else {
            <i class="bi bi-building"></i>
          }
        </div>
        <div class="header-info">
          <h1 class="position-title">{{ application()!.job?.title || 'Unknown Position' }}</h1>
          <p class="company-name">{{ application()!.job?.company || 'Unknown Company' }}</p>
          @if (application()!.job?.location) {
            <span class="location"><i class="bi bi-geo-alt me-1"></i>{{ application()!.job!.location }}</span>
          }
        </div>
      </div>
      <div class="header-actions">
        <select
          class="status-select {{ getStatusClass(application()!.status) }}"
          [ngModel]="application()!.status"
          (ngModelChange)="onStatusChange($event)"
          [disabled]="updatingStatus()"
        >
          @for (s of statuses; track s) {
            <option [value]="s">{{ formatStatus(s) }}</option>
          }
        </select>
      </div>
    </div>

    <!-- Info Grid -->
    <div class="info-grid">
      <div class="info-card">
        <div class="info-label"><i class="bi bi-calendar-event me-2"></i>Applied Date</div>
        <div class="info-value">{{ formatDate(application()!.appliedDate) }}</div>
      </div>
      <div class="info-card">
        <div class="info-label"><i class="bi bi-send me-2"></i>Submission Type</div>
        <div class="info-value">{{ formatStatus(application()!.submissionType) }}</div>
      </div>
      @if (application()!.atsType) {
        <div class="info-card">
          <div class="info-label"><i class="bi bi-robot me-2"></i>ATS Type</div>
          <div class="info-value">{{ formatStatus(application()!.atsType!) }}</div>
        </div>
      }
      @if (application()!.interviewDate) {
        <div class="info-card highlight">
          <div class="info-label"><i class="bi bi-camera-video me-2"></i>Interview Date</div>
          <div class="info-value">{{ formatDate(application()!.interviewDate!) }}</div>
        </div>
      }
      @if (application()!.followUpDate) {
        <div class="info-card">
          <div class="info-label"><i class="bi bi-bell me-2"></i>Follow Up</div>
          <div class="info-value">{{ formatDate(application()!.followUpDate!) }}</div>
        </div>
      }
    </div>

    <!-- Notes Section -->
    @if (application()!.notes) {
      <div class="section-card">
        <h3><i class="bi bi-journal-text me-2"></i>Notes</h3>
        <p class="notes-text">{{ application()!.notes }}</p>
      </div>
    }

    <!-- Error Log (for failed) -->
    @if (application()!.errorLog) {
      <div class="section-card error">
        <h3><i class="bi bi-exclamation-triangle me-2"></i>Error Log</h3>
        <pre class="error-log">{{ application()!.errorLog }}</pre>
      </div>
    }

    <!-- Job Details -->
    @if (application()!.job) {
      <div class="section-card">
        <h3><i class="bi bi-briefcase me-2"></i>Job Details</h3>
        <p class="job-description">{{ application()!.job!.description }}</p>
        @if (application()!.job!.requirements.length) {
          <h4>Requirements</h4>
          <ul class="requirements-list">
            @for (req of application()!.job!.requirements; track req) {
              <li>{{ req }}</li>
            }
          </ul>
        }
      </div>
    }

    <!-- Danger Zone -->
    <div class="danger-zone">
      <button class="btn-danger" (click)="deleteApplication()">
        <i class="bi bi-trash3 me-2"></i>
        Delete Application
      </button>
    </div>
  } @else {
    <div class="empty-state">
      <div class="empty-icon"><i class="bi bi-inbox"></i></div>
      <h4>Application not found</h4>
      <p>The application you're looking for doesn't exist or has been removed.</p>
      <button class="btn-back" (click)="goBack()">Back to Applications</button>
    </div>
  }
</div>

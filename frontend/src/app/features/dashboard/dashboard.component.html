<div class="dashboard-container">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Welcome back, {{ currentUser()?.firstName }}!</h1>
      <p class="page-subtitle">Here's your job search overview</p>
    </div>
    <button class="btn-refresh" (click)="refreshData()">
      <i class="bi bi-arrow-clockwise me-2"></i>Refresh
    </button>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading dashboard...</p>
    </div>
  } @else {
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon blue"><i class="bi bi-briefcase"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats().totalJobs }}</span>
          <span class="stat-label">Total Jobs</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon green"><i class="bi bi-send-check"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats().totalApplications }}</span>
          <span class="stat-label">Applications</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon amber"><i class="bi bi-hourglass-split"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats().pendingApplications }}</span>
          <span class="stat-label">Pending</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon purple"><i class="bi bi-stars"></i></div>
        <div class="stat-info">
          <span class="stat-value">{{ stats().averageMatchScore }}%</span>
          <span class="stat-label">Avg Match</span>
        </div>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- High Match Jobs -->
      <div class="content-card">
        <div class="card-header">
          <h2 class="card-title"><i class="bi bi-lightning-charge me-2"></i>High Match Jobs</h2>
          <a routerLink="/jobs" class="view-all-link">View All <i class="bi bi-chevron-right"></i></a>
        </div>
        <div class="card-body">
          @if (highMatchJobs().length > 0) {
            <div class="job-items">
              @for (job of highMatchJobs(); track job.id) {
                <a class="job-item" [routerLink]="['/jobs', job.id]">
                  <div class="job-item-left">
                    <div class="job-item-avatar">
                      @if (job.companyLogo) {
                        <img [src]="job.companyLogo" [alt]="job.company" />
                      } @else {
                        <i class="bi bi-building"></i>
                      }
                    </div>
                    <div class="job-item-info">
                      <span class="job-item-title">{{ job.title }}</span>
                      <span class="job-item-company">{{ job.company }}</span>
                      <span class="job-item-meta">{{ job.location }}</span>
                    </div>
                  </div>
                  <div class="match-badge">{{ job.matchScore }}%</div>
                </a>
              }
            </div>
          } @else {
            <div class="empty-card-state">
              <i class="bi bi-briefcase"></i>
              <p>No high match jobs found</p>
              <button class="btn-sm-action" (click)="refreshData()">Fetch Jobs</button>
            </div>
          }
        </div>
      </div>

      <!-- Recent Applications -->
      <div class="content-card">
        <div class="card-header">
          <h2 class="card-title"><i class="bi bi-clock-history me-2"></i>Recent Applications</h2>
          <a routerLink="/applications" class="view-all-link">View All <i class="bi bi-chevron-right"></i></a>
        </div>
        <div class="card-body">
          @if (recentApplications().length > 0) {
            <div class="app-items">
              @for (app of recentApplications(); track app.id) {
                <a class="app-item" [routerLink]="['/applications', app.id]">
                  <div class="app-item-info">
                    <span class="app-item-title">{{ app.job?.title || 'Unknown Position' }}</span>
                    <span class="app-item-company">{{ app.job?.company || 'Unknown' }}</span>
                    <span class="app-item-date">{{ app.appliedDate | date:'mediumDate' }}</span>
                  </div>
                  <span class="app-status-badge {{ app.status }}">
                    {{ app.status | titlecase }}
                  </span>
                </a>
              }
            </div>
          } @else {
            <div class="empty-card-state">
              <i class="bi bi-inbox"></i>
              <p>No applications yet</p>
              <a routerLink="/jobs" class="btn-sm-action">Browse Jobs</a>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h3 class="section-label">Quick Actions</h3>
      <div class="actions-grid">
        <a routerLink="/jobs" class="action-card">
          <div class="action-icon blue"><i class="bi bi-search"></i></div>
          <span class="action-label">Browse Jobs</span>
        </a>
        <a routerLink="/resume-score" class="action-card">
          <div class="action-icon purple"><i class="bi bi-star"></i></div>
          <span class="action-label">Resume Score</span>
        </a>
        <a routerLink="/resume-builder" class="action-card">
          <div class="action-icon green"><i class="bi bi-file-earmark-text"></i></div>
          <span class="action-label">AI Resume</span>
        </a>
        <a routerLink="/profile" class="action-card">
          <div class="action-icon amber"><i class="bi bi-person"></i></div>
          <span class="action-label">Profile</span>
        </a>
      </div>
    </div>
  }
</div>
